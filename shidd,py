import discord
import asyncio
from discord.ext import commands

bot = commands.Bot(command_prefix = 'vm.')
bot.remove_command('help')

global isConnected
isConnected = False

singurl = 'https://cdn.discordapp.com/attachments/741671237994151957/781515376235511808/download.jpg'


@bot.event
async def on_ready(): #prints bot ready when loaded up
  print("Bot Ready")
  activity = discord.Activity(name='vm.help', type=discord.ActivityType.listening)
  await bot.change_presence(activity=activity)
  

@bot.command() #STARTER COMMAND
async def help(ctx):
  embed = discord.Embed(title="Welcome!",
                        color=discord.Color.green())
  embed.set_image(
    url='https://cdn.discordapp.com/attachments/764744705460142100/781415325852893224/vm.jpg')

  embed.add_field(name="vm.play", value="plays vennu mallesh top banger\n", inline=False)
  embed.add_field(name="vm.leave", value="disconnects from voice chat", inline=False)
  embed.add_field(name="vm.volume <number>", value="sets volume", inline=False)

  await ctx.send(embed=embed)


@bot.command()# PLAYS TOP BANGER
async def play(ctx):
  channel = ctx.author.voice.channel
  vc = await channel.connect(timeout=15.0, reconnect=True)
  source = discord.PCMVolumeTransformer(discord.FFmpegPCMAudio(executable = r"C:\Users\young\Desktop\vm bot\ffmpeg\bin\ffmpeg.exe", source = "bruhsong.mp3"))
  ctx.voice_client.play(source, after=lambda e: print('Player error: %s' % e) if e else None)
  await ctx.send("Now Playing: Vennu Mallesh Top Banger- It's my life")
  await ctx.send('https://cdn.discordapp.com/attachments/741671237994151957/781515376235511808/download.jpg')



@bot.command() #LEAVES VOICE CHAT
async def leave(ctx):
  await ctx.voice_client.disconnect()
  if ctx.voice_client is None:
    return await ctx.send("Not connected to a voice channel.")
  


@bot.command()#CONTROLS VOLUME
async def volume(ctx, volume: int):
  ctx.voice_client.source.volume = volume / 100
  await ctx.send("Changed volume to {}%".format(volume))
  if ctx.voice_client is None:
    return await ctx.send("Not connected to a voice channel.")


bot.run('NzgxMzg5NjUyNjE1MjMzNTQw.X7870g.9OBuziesET1Or_6dOqaCbwlF0sA')


